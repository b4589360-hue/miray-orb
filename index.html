<script>
const orb = document.querySelector('.orb');
const statusText = document.getElementById('status');
const resultBox = document.getElementById('result');

function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "tr-TR";
  u.rate = 1.0;
  u.pitch = 0.9;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function cleanQuery(text){
  return text
    .toLowerCase()
    .replace("araştırır mısın","")
    .replace("araştırır mısın","")
    .replace("araştır","")
    .replace("nedir","")
    .replace("?","")
    .trim();
}

async function searchWiki(query){
  resultBox.innerHTML = "Araştırılıyor...";
  
  try{
    const res = await fetch(
      `https://tr.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`
    );
    
    if(!res.ok) throw new Error("Bulunamadı");

    const data = await res.json();

    resultBox.innerHTML = `
      <b>Konu:</b> ${data.title}<br><br>
      ${data.extract}
    `;

    speak(data.extract);

  }catch(e){
    resultBox.innerHTML = `
      <b>Konu:</b> Bulunamadı<br><br>
      Wikipedia’da sonuç bulamadım.
    `;
    speak("Wikipedia’da sonuç bulamadım Bünyamin");
  }
}

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = "tr-TR";

orb.addEventListener("click", () => {
  recognition.start();
  statusText.innerText = "Dinliyorum...";
});

recognition.onresult = (event) => {
  const raw = event.results[0][0].transcript;
  statusText.innerText = "Hazır";

  const query = cleanQuery(raw);

  if(raw.toLowerCase().includes("araştır") || raw.toLowerCase().includes("nedir")){
    searchWiki(query);
  } else {
    speak("Anlayamadım Bünyamin");
  }
};
</script>